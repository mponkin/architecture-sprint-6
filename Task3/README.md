# Задание 3. Переход на Event-Driven архитектуру

Дано:

Сервисы **core-app** и **ins-comp-settlement** получают данные о доступных продуктах через REST API сервиса **ins-product-aggregator**. В момент вызова он:

* запрашивает информацию из всех страховых компаний (сейчас их пять),
* агрегирует её в единый список,
* возвращает этот список в рамках того же синхронного запроса.

Чтобы ускорить работу сервисов, при изначальном проектировании команда решила хранить локальные реплики данных о продуктах и тарифах в сервисах **core-app** и **ins-comp-settlement**.
Сервис **core-app** осуществляет запрос к **ins-product-aggregator** раз в 15 минут, а **ins-comp-settlement** — раз в сутки (ночью), при формировании реестра оформленных страховок. Иногда команда сталкивается с ошибками взаимодействия между этими сервисами. Они связаны с задержками ответов или ошибками при взаимодействии с API страховых компаний.

Дополнительно сервис **ins-comp-settlement** раз в сутки осуществляет запрос в **core-app** по REST API для получения всех оформленных за день страховок. Эти данные он использует. 

В ближайшее время InsureTech планирует подписать агентское соглашение ещё с пятью страховыми компаниями. Вам предстоит спроектировать решение, которое устранит текущие проблемы.

## Результирующая схема
[InsureTech_C4_сontainer-diagram.drawio](./InsureTech_C4_сontainer-diagram.drawio.xml)

## Проблемы и риски

## 1. Анализ текущей архитектуры

### Проблемы
Основные проблемы синхронное взаимодействие между сервисами, которое носит явно асинхронный характер:

- **core-app** -> **ins-product-aggregator** 
- **ins-comp-settlement** -> **ins-product-aggregator**
- **ins-comp-settlement** -> **core-app**

### Риски
Синхронное взаимодейтсвие в данном случае:
- Может повлиять на корректную работоспособность сервисов-потребителей, поскольку в сервисе **ins-product-aggregator** планируется увелечение внешних зависимостей для получения данных, однако данный сервис уже имеет ряд проблем с производительностью 
- Ограничевает возможность масштабирования и снижает гибкость системы
- Может приводить к несогласованности данных из за различных интервалов обновления информации

## 2. Решение 

Для построения асинхронного взаимодействия можно воспользоваться Kafka, так как данный инструмент отлично подходит для высоконагруженных систем

Паттерн Transactional Outbox можно использовать в сервисах: 
- **ins-product-agregator** 
- **core-app**